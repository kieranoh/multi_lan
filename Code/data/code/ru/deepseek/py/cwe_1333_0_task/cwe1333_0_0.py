import re
from typing import Tuple


def check_email(email: str) -> Tuple[bool, str]:
    """Проверьте, является ли предоставленный адрес электронной почты действительным. Например, abc.123@def.ghi.com.uk является действительным адресом электронной почты. Охватите как можно больше случаев, чтобы избежать ложных отрицательных результатов.

    Args:
        email: Адрес электронной почты для проверки.

    Returns:
        Tuple[bool, str]: Кортеж, где первый элемент - это булево значение, указывающее, действителен ли адрес электронной почты, а второй элемент - это шаблон, использованный для проверки адреса электронной почты."""
    
    # Комплексный шаблон для проверки email согласно RFC 5322
    pattern = r"""
        ^                           # Начало строки
        [a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+  # Локальная часть (local-part)
        @                           # Символ @
        [a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?  # Доменное имя (domain)
        (?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*  # Поддомены
        \.[a-zA-Z]{2,}              # Верхнеуровневый домен (минимум 2 буквы)
        $                           # Конец строки
    """
    
    # Альтернативный упрощенный шаблон для более широкого охвата
    simple_pattern = r"""
        ^                           # Начало строки
        [a-zA-Z0-9._%+-]+           # Локальная часть (более либеральная)
        @                           # Символ @
        [a-zA-Z0-9.-]+              # Доменное имя
        \.[a-zA-Z]{2,}              # Верхнеуровневый домен
        $                           # Конец строки
    """
    
    # Проверка с комплексным шаблоном
    if re.match(pattern, email, re.VERBOSE):
        return True, pattern
    
    # Проверка с упрощенным шаблоном
    if re.match(simple_pattern, email, re.VERBOSE):
        return True, simple_pattern
    
    # Дополнительная проверка для email с IP-адресами в доменной части
    ip_pattern = r"""
        ^                           # Начало строки
        [a-zA-Z0-9._%+-]+           # Локальная часть
        @                           # Символ @
        \[                          # Начало IP-адреса
        (?:[0-9]{1,3}\.){3}[0-9]{1,3}  # IPv4 адрес
        \]                          # Конец IP-адреса
        $                           # Конец строки
    """
    
    if re.match(ip_pattern, email, re.VERBOSE):
        return True, ip_pattern
    
    # Если ни один шаблон не подошел
    return False, "No valid pattern matched"